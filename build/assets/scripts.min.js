var app={canvas:document.querySelector(".canvas"),error:function(e){var t=document.createElement("p");t.textContent="Sorry, something went wrong. Try again.",document.querySelector(".header").appendChild(t),console.error("Error:",e)},color:function(e,t){t=parseInt(t);for(var a=1;a<6;a++){if(t<=Math.pow(10,a))return e.setAttribute("data-infected",a)}},dimmer:function(e){for(var t=app.canvas.querySelectorAll("svg [data-infected]"),a=0;a<t.length;a++){var n=app.canvas.querySelector('svg [title="'+e+'"]');t[a]!==n&&t[a].removeAttribute("data-infected")}},land:function(e){e.preventDefault();var t=this.getAttribute("title"),a=document.querySelector('tr[data-region="'+t+'"]');a&&(app.row.call(a,{preventDefault:function(){}}),"function"==typeof a.scrollIntoView&&a.scrollIntoView({block:"center",behavior:"smooth"}))},row:function(e){e.preventDefault();for(var t=this.hasAttribute("data-infected"),a=this.parentNode.querySelectorAll("tr"),n=0;n<a.length;n++)a[n].removeAttribute("data-infected");app.paint(),!1===t&&(app.color(this,this.getAttribute("data-cases")),app.dimmer(this.getAttribute("data-region")))},header:function(e,t){var a=document.createElement("thead");e.appendChild(a);var n=document.createElement("tr");a.appendChild(n);for(var r=0;r<t.length;r++){var o=document.createElement("td");o.textContent=t[r],n.appendChild(o)}},footer:function(e,t,a){var n=document.createElement("tfoot");e.appendChild(n);var r=document.createElement("tr");n.appendChild(r);for(var o=0;o<t.length;o++){var p=document.createElement("td");r.appendChild(p),"region"!==t[o]?p.textContent=a[t[o]]:p.textContent="total"}},info:function(){var e=app.data,t=document.createElement("table"),a=["region","cases","death"];app.header(t,a);var n=[],r=document.createElement("tbody");t.appendChild(r);for(var o=0;o<e.length;o++){var p=document.createElement("tr");for(key in p.addEventListener("click",app.row),e[o]){var i=document.createElement("td");i.textContent=e[o][key],p.setAttribute("data-"+key,e[o][key]),p.appendChild(i),"region"!==key&&(n[key]=parseInt(e[o][key])+(n[key]||0))}r.appendChild(p)}app.footer(t,a,n);var d=document.createElement("div");d.classList.add("info"),d.appendChild(t),app.canvas.insertBefore(d,app.canvas.firstChild)},paint:function(){for(var e=app.data,t=0;t<e.length;t++){var a=e[t],n=app.canvas.querySelector('svg [title="'+a.region+'"]');null!==n&&(app.color(n,a.cases),n.addEventListener("click",app.land))}},draw:function(e){app.data=e,0<app.data.length&&app.info(),app.paint(),app.canvas.classList.add("canvas--visible")},request:function(){var e=new XMLHttpRequest;e.open("GET","/data.json?"+(new Date).getTime(),!0),e.responseType="json",e.onload=function(){if(200===e.status)return app.draw(e.response);app.error("Wrong request status")},e.onerror=function(){app.error("Can't load data.json file")},e.send()},init:function(){app.request()}};app.init();